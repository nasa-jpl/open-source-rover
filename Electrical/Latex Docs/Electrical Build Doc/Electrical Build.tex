\documentclass[12pt]{article}
\usepackage[margin=1in]{geometry}
\usepackage{setspace}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{amsmath}
\usepackage{color}
\usepackage{hyperref}
\usepackage{multicol}
\usepackage{framed}
\usepackage{xcolor}
\usepackage{wrapfig}
\usepackage{float}
\usepackage{fancyhdr}
\usepackage{verbatim}
\usepackage{wrapfig}
\usepackage{colortbl}
\usepackage{array, booktabs, caption}
\usepackage{makecell}
\usepackage{tcolorbox}
\usepackage{lipsum}

\pagestyle{fancy}
\lfoot{\textbf{Open Source Rover Electrical Assembly}}
\rfoot{Page \thepage}
\lhead{\textbf{\leftmark}}
\rhead{\textbf{\rightmark}}
\cfoot{}
\renewcommand{\footrulewidth}{1.8pt}
\renewcommand{\headrulewidth}{1.8pt}
\doublespacing
\setlength{\parindent}{1cm}


\definecolor{mycolor}{rgb}{0.122, 0.435, 0.698}% Rule colour
\makeatletter
\newcommand{\mybox}[1]{%
  \setbox0=\hbox{#1}%
  \setlength{\@tempdima}{\dimexpr\wd0+13pt}%
  \begin{tcolorbox}[colframe=mycolor,boxrule=0.5pt,arc=4pt,
      left=6pt,right=6pt,top=6pt,bottom=6pt,boxsep=0pt,width=0.95\textwidth]
    #1
  \end{tcolorbox}
}
\makeatother

% Parts list tables
\renewcommand\theadfont{\bfseries}
\newcolumntype{I}{ >{\centering\arraybackslash} m{2cm} }  % part image
\newcolumntype{N}{ >{\centering\arraybackslash} m{3cm} }  % part name
\newcolumntype{Q}{ >{\centering\arraybackslash} m{0.75cm} }  % ref & qty

\newcommand\partimg{\includegraphics[width=2cm,height=1.25cm,keepaspectratio]}

\begin{document}

\title{Open Source Rover: Electrical Assembly Instructions}
\author{Authors: Michael Cox, Eric Junkins, Olivia Lofaro}

\makeatletter         
\def\@maketitle{
\begin{center}	
	\makebox[\textwidth][c]{ \includegraphics[width=0.8\paperwidth]{"Pictures/Electronics/electronics title".png}}
	{\Huge \bfseries \sffamily \@title }\\[3ex] 
	{\Large \sffamily \@author}\\[3ex] 
	\includegraphics[width=.85\linewidth]{"Pictures/Electronics/JPL logo".png}
\end{center}}
\makeatother

\maketitle

\noindent {\footnotesize Reference herein to any specific commercial product, process, or service by trade name, trademark, manufacturer, or otherwise, does not constitute or imply its endorsement by the United States Government or the Jet Propulsion Laboratory, California Institute of Technology. \textcopyright  2018 California Institute of Technology. Government sponsorship acknowledged}


% Introduction
\newpage


\tableofcontents

\newpage

\section{Overview}

First, it is important to examine the components we will use in the rover and understand how both data and power travel through the system. Figure \ref{power} shows how each of the electrical components and boards receives power, and Figure \ref{data} shows how data are sent from each of the electrical systems and what communication protocol it uses. 
\begin{figure}[H]
  	\centering
    	\includegraphics[width=1\textwidth]{"Pictures/Electronics/power diagram".PNG}
  	\caption{Electrical Power Overview}
	\label{power}
\end{figure}

\noindent One important thing to note from the above is that there are multiple different voltages in the system. There is the unregulated voltage coming from the battery, 5V regulated coming from the voltage regulator, and the 12V motor voltage which is sent from the motor controllers to the motors. 

\begin{figure}[H]
  	\centering
   	\includegraphics[width=1\textwidth]{"Pictures/Electronics/data diagram".PNG}
  	\caption{Electrical Data Overview}
	\label{data}
\end{figure}

\noindent For the data transmission, we use both 3.3V and 5V digital logic systems, analog signals (of varying max voltages), and serial communication between devices. Information on these protocols can be found at:

\begin{itemize}
	\item \href{https://en.wikipedia.org/wiki/Serial_communication}{https://en.wikipedia.org/wiki/Serial\_communication}
	\item \href{https://learn.sparkfun.com/tutorials/analog-vs-digital}{https://learn.sparkfun.com/tutorials/analog-vs-digital}
\end{itemize}


\begin{tabular}[2]{|p{4cm}|p{11cm}|}
	\hline
	\textbf{Part} & \textbf{Description} \\ \hline
	Battery & Provides power to the system. Has an unregulated voltage range of around 11.5V - 16.75V depending on its charge level \\ \hline
	Switch & Mechanical disconnect of the electrical power to the rest of the robot \\ \hline
	Volt Meter & Monitors and displays information such as current draw, voltage level, and power consumption of the robot \\ \hline
	Voltage Regulator & Takes in the unregulated battery voltage and outputs a steady regulated voltage of 5 volts for consumption by electronics. \\ \hline
	Raspberry Pi 3 & Acts as the brains and processing power of the robot \\ \hline
	LED Matrix & Gives the robot a display and a personality\\ \hline
	Motor Controllers & Sends voltage signals to the motors telling the motors the direction and speed at which to spin. Reads encoder data \\ \hline
	Encoders & Monitors the position of the motor to give information about speed and position \\ \hline
	Custom PCBs & Single purpose boards custom-made for this project. Each of these will be explained later on in this document. \\ \hline
\end{tabular}

\subsection{Tools Necessary}

\begin{figure}[H]
  	\centering
   	\includegraphics[width=0.8\textwidth]{"Pictures/Electronics/elec parts".PNG}
  	\caption{}
	\label{elec parts}
\end{figure}

This project assumes you have the tools shown in Figure \ref{elec parts}. These will all be used in the construction and testing/debugging of this project. Most of these can be purchased inexpensively though DigiKey, Amazon, or other retailers. 

\subsection{Component Descriptions}
The following are brief descriptions and basic notes about some of the components we use in this project. For more detailed information on each component, consult the data sheet for that component. 
\subsubsection{Battery}
The battery is used to power all the electrical components and the motors in our rover. The biggest driving factor for battery selection was safety of the battery chemistry while still being able to drive the current and voltage necessary for operation of all the electronics (we'll go into these requirements more later). The recommended battery was chosen because of its Poly Switch and PCB protection. These limit the amount of current that can be pulled from the battery, as well as give protection against things like electrical shorts and overcharging/fully discharging the battery. 
\subsubsection{Voltage Regulators}
As our battery outputs unregulated voltage based on its charge level, voltage regulators are added to give steady DC power to the electronic components. There is a 5V regulator that runs the raspberry pi and the LED matrix, and a 12V regulator that supplies power to the motors which run on 12 volts. 
\subsubsection{Raspberry Pi 3}
We selected the Raspberry Pi 3 Model B as the "brain" of the rover. We chose the Pi because it allows users at many levels of programming knowledge to gain familiarity in basic programming concepts without a complicated learning curve. It is also widely used in the maker community, so modifications and additions on the base rover should be easy. The Pi 3 also comes with WiFi and bluetooth modules built into the board and we therefore don't need additional dongles to communicate over WiFi or bluetooth.  This retains all 4 USB ports for addons and modifications to the project.  

\subsubsection{Printed Circuit Boards}
In order to simplify the electronics of the rover, we designed a few single purpose Printed Circuit Boards (PCBs). In total, there are three boards:
\bigskip

\begin{tabular}[2]{| p{5cm} | p{10cm} | }
	\hline
	\textbf{Board} & \textbf{Description/Purpose} \\ \hline
	Voltage Divider & Distributes the +5V and GND to power the absolute encoders. Also takes the 0-5V signal from the encoders and transforms it to a 0-2V signal that the controllers expect \\ \hline
	Logic Shifter & Takes the 3.3V digital signals from the raspberry pi and converts them to a 5V digital signal output \\ \hline
	Serial Splitter & Takes the TX/RX serial read/write lines and the +5V and GND power pins from the Raspberry Pi and distributes them to each motor controller. \\ \hline
\end{tabular}
\bigskip

\subsubsection{LED Matrix}
The LED Matrix is a 16x32 pixel display that is controlled through the Raspberry Pi\footnote{This display uses a lot of the Pi's GPIO pins.  If you need many GPIO pins for your own additions, you may want to swap this display out for another option.}. In order to integrate this display into our rover, we followed along with an Adafruit project (but added our own custom PCB which isn't in this tutorial). This tutorial can be found at: \href{https://learn.adafruit.com/connecting-a-16x32-rgb-led-matrix-panel-to-a-raspberry-pi/overview}{https://learn.adafruit.com/connecting-a-16x32-rgb-led-matrix-panel-to-a-raspberry-pi/overview}

\subsubsection{Motors}
Motors cause the actual movement of the robot. There are many types of motors; in this project we will be used brushed DC motors. More information on different types of motors and a link about how brushed DC motors work can be found at the following links:
\begin{itemize}
	\item \href{https://en.wikipedia.org/wiki/Brushed_DC_electric_motor}{https://en.wikipedia.org/wiki/Brushed\_DC\_electric\_motor}
	\item \href{https://en.wikipedia.org/wiki/Electric_motor}{https://en.wikipedia.org/wiki/Electric\_motor}
\end{itemize}

\subsubsection{Encoders}
Encoders give us readings on the position and speed of motors as they spin. There are two types of encoders in this project: absolute and quadrature. An absolute encoder is used to get the position of the motor on a fixed scale such that you always know the position of the motor even after power cycling the system. This type of encoder will usually have one output, which will either be a PWM digital signal or an analog signal. Each of these signals will have a specific reading corresponding to where it is on the fixed position scale. These are typically more expensive than their quadrature encoder counterparts, which will sense position only relative to the last time the power was cycled or the signal was reset. Quadrature encoders use two digital signals and look at the different between the signals to sense movement. More information about quadrature encoders can be found at: 

\begin{itemize}
	\item \href{http://www.dynapar.com/Technology/Encoder_Basics/Quadrature_Encoder/}{http://www.dynapar.com/Technology/Encoder\_Basics/Quadrature\_Encoder/}  
\end{itemize}

\noindent In this project, we use absolute encoders on the corner wheels to get absolute measurements on where the wheels are turned. We use quadrature encoders at each of the driving wheels to get speed measurements.


\section{Powering Components}
Here we will be setting up the connections to the electrical components. It is recommended that you try hooking up each of these components outside of the robot body first to test in a simpler environment and to make sure you fully understand how all the signals are passed around. This guide also assumes that you have already followed the PCB Testing guide and that you have fully tested and functioning PCBs.


\mybox{
When connecting any of the power lines it is important to consider how much current will be running through that wire, and select the appropriate wire gauge to handle that current. For more information on wire gauge selection you can visit: \href{https://www.bluesea.com/support/articles/Circuit_Protection/1437/Part_1\%3A_Choosing_the_Correct_Wire_Size_for_a_DC_Circuit}{https://www.bluesea.com/support/articles/Circuit\_Protection/1437}
}

\noindent During this project you will need to cut, strip, and solder wires to extend and split electrical connections. It is important to understand how to do this safely so that you are protecting your system from electrical shorts. Below are a few quick links on these skills, however it is crucial that you fully understand these processes before proceeding. 

\begin{itemize}
	\item \href{https://learn.sparkfun.com/tutorials/working-with-wire/how-to-strip-a-wire}{https://learn.sparkfun.com/tutorials/working-with-wire/how-to-strip-a-wire}
	\item \href{https://www.wikihow.com/Splice-Wire}{https://www.wikihow.com/Splice-Wire}
	\item \href{https://www.youtube.com/watch?v=Y8wjv6lj5KU}{https://www.youtube.com/watch?v=Y8wjv6lj5KU}
\end{itemize}

\noindent \textbf{**Note** Please read through this entire section and understand it fully before starting to connect devices and electronics together. }

\subsection{Connectors, Switch, and Volt Meter}

We'll start with the battery and connecting it through the switch and volt meter. Figure \ref{battery section} shows the section of the power diagram we'll be working on, with components and connections that we make in this section marked in \textcolor{red}{\textbf{RED}}.

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.9\textwidth]{"Pictures/Electronics/battery section".PNG}
 	\caption{Battery section Overview}
	\label{battery section}
\end{figure}

\mybox{
There are a couple of \textbf{very important} things to be aware of as you are making these connections, as with any project where you are working with batteries or electrical current:
\newline
\noindent \textbf{THE BATTERY IS LIVE AT ALL TIMES}. This means that at any point, if the two terminals of the battery come in contact they will cause an electrical short. This may trigger the protection circuit in the battery and prevent extensive damage, but we do not want to rely on that for safety. \textbf{Make sure to keep the terminals of the +V and GND separated at all times with no possibility of contact.}
\newline
\noindent The connectors will only fit together one way. That means you have to make sure your connections are correct the first time when soldering them in: make sure to verify this before connecting anything to the battery.
\newline
\noindent The switch we use is a Single Pole - Single Throw switch. This means that either the two terminals are connected together in one switch position or there is a physical disconnect when the switch is in the other position. Make sure to test the switch and know which are its ON and OFF positions previous to connecting it to anything.
\newline
\noindent  It is extremely important to plug the battery in the correct direction into the volt meter as well, as plugging it in backwards (even for an instant) could damage the volt meter. 
}

\begin{table}[H]
	\centering
	\arrayrulecolor{lightgray}
	\sffamily\footnotesize
	\captionsetup{font={sf,bf}}
	\caption{Parts Necessary}
	\begin{tabular}{|N|Q|Q|I|N|Q|Q|I|}
			\hline
			\thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} & \thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} \\
			\hline
			Battery & E12 & 1 & \partimg{../../../images/parts_list/E12.png} & Tamiya Connectors & E24 & 1 & \partimg{../../../images/parts_list/E24.jpg} \\ \hline
			Switch & E25 & 1 & \partimg{../../../images/parts_list/E25.jpg} & Battery Volt Meter & E15 & 1 & \partimg{../../../images/parts_list/E15.jpg} \\ \hline
			16 AWG Wire (Black) & E28 & 1 & \partimg{../../../images/parts_list/wire.jpg} & 16 AWG Wire (Red) & E29 & 1 & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
	\end{tabular}
\end{table}

Using the Tamiya connectors, connect the battery to the switch and then the volt meter according to Figure \ref{sw sch} using 16 AWG wire. The Tamiya connectors allow you to disconnect the battery from the rest of the system so you can recharge the battery. 

\begin{figure}[H]
  	\centering
    	\includegraphics[width=1\textwidth]{"Pictures/Electronics/Switch schematic".PNG}
 	\caption{Battery connection through switch and volt meter}
	\label{sw sch}
\end{figure}



The battery will live in the body of the rover above the electronics plate, with the switch mounted to any of your choice of the 0.5in holes in the body, and the volt meter has a press fit cutout in the back panel. Figure \ref{vms} shows an example of how we installed the switch, and the volt meter/ Tamiya connectors. Note how the connectors are available readily (in our case, outside the rover). This allows us to unplug the battery and charge it without removing any of the rover's components. 


\begin{figure}[H]
 	\centering
  	\begin{minipage}[b]{0.40\textwidth}
		\includegraphics[width=\textwidth]{"Pictures/Routing/switch".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.50\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Electronics/voltmeter".png}
  	\end{minipage}
	\caption{Installing the switch and voltmeter}
	\label{vms}
\end{figure}



\subsection{Volt Meter and Voltage Regulator}
Next, we connect the output side of the volt meter to the 5V voltage regulator and the motor controllers. Figure \ref{motor cont} shows the section of the power diagram we'll be working on, with components and connections that we make in this section marked in \textcolor{red}{\textbf{RED}}.

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.9\textwidth]{"Pictures/Electronics/motor cont".PNG}
 	\caption{Regulator and Motor Controllers Overview}
	\label{motor cont}
\end{figure}

\begin{table}[H]
	\centering
	\arrayrulecolor{lightgray}
	\sffamily\footnotesize
	\captionsetup{font={sf,bf}}
	\caption{Parts Necessary}
	\begin{tabular}{|N|Q|Q|I|N|Q|Q|I|}
			\hline
			\thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} & \thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} \\
			\hline
			5V Voltage Regulator & E4 & 1 & \partimg{../../../images/parts_list/E4.png} & RoboClaw Motor Controller & E2 & 1 & \partimg{../../../images/parts_list/E2.jpg} \\ \hline
			20 AWG Wire (Black) & E30 & 1 & \partimg{../../../images/parts_list/wire.jpg} & 20 AWG Wire (Red) & E31 & 1 & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
	\end{tabular}
\end{table}

The "LOAD" terminals of the volt meter are the electrical load of the robot, which correspond to all the electronics running in the robot. Figure \ref{vm sch} shows the pin-out of how to connect the volt meter to the 5V regulator and the motor controllers.

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.75\textwidth]{"Pictures/Electronics/Vm to reg".PNG}
 	\caption{Volt Meter to Electronics connections}
	\label{vm sch}
\end{figure}

\mybox{
\noindent  The LOAD+ pin should connect to VIN on the 5V Regulator, and + on each of the RoboClaw Motor Controllers, and the LOAD- pin should connect to GND on the Regulator and - on the RoboClaws. After the Volt Meter, you should break out the connections to the regulator and RoboClaws into two separate wires, each with sufficient wire gauge. The 5V regulator will be fine with 20AWG wire, but the power lines running to every motor controller should be 16AWG.  
}

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.45\textwidth]{"Pictures/Electronics/5V in_out".PNG}
 	\caption{Voltage Regulator Diagram}
	\label{regs}
\end{figure}

\noindent Figure \ref{vm2rcs} shows an example of one way we did the wire routing for power to the motor controllers. We can see that the power was split off before reaching any of the motor controllers, and instead each of them individually got a power and ground wire. 

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.75\textwidth]{"Pictures/Routing/power to rcs".PNG}
 	\caption{Powering the RoboClaws}
	\label{vm2rcs}
\end{figure}


\mybox{
Before connecting to the rest of the electronics, we will want to test the voltage coming out of the 5V regulator. To do this, use a Multi-meter to test the voltage across the VOUT and GND pins.  You should see very close to 5V. \textbf{Be very careful not to short across the GND and VOUT pins while testing} as this could short the regulator and cause it to break.
}

\subsection{Powering the Raspberry Pi}
Next, we need to bring power to the Raspberry Pi. It requires a regulated 5V DC power source, so it will be powered from the 5V regulator. Figure \ref{ss} shows the section of the power diagram we'll be working on, with components and connections that we make in this section marked in \textcolor{red}{\textbf{RED}}.

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.9\textwidth]{"Pictures/Electronics/rpi power".PNG}
 	\caption{Powering the Raspberry Pi}
	\label{rpi power}
\end{figure}

\mybox{
\textbf{Note:} If you plan on using the LED matrix / face, you should split 5V power off of the 5V regulator before the Raspberry Pi, which should be done now. As the LED Matrix takes up a large number of GPIO pins which some might want for other devices, it's not a required part of the project and thus there is a separate document describing how to put it together.
} 

\begin{table}[H]
	\centering
	\arrayrulecolor{lightgray}
	\sffamily\footnotesize
	\captionsetup{font={sf,bf}}
	\caption{Parts Necessary}
	\begin{tabular}{|N|Q|Q|I|N|Q|Q|I|}
			\hline
			\thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} & \thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} \\
			\hline
			Raspberry Pi 3B & E1 & 1 & \partimg{../../../images/parts_list/E1.jpg} & & & & \\ \hline
			20 AWG Wire (Black) & E30 & 1 & \partimg{../../../images/parts_list/wire.jpg} & 20 AWG Wire (Red) & E31 & 1 & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
	\end{tabular}
\end{table}

\noindent To power the Raspberry Pi, we soldered the 5V and GND from the 5V regulator directly to the power pads on the bottom of the Raspberry Pi. The positive voltage goes to pad PP2 and negative/ground goes to pad PP5 in Figure \ref{rpi pads}. For more information and a video on doing this you can follow this link and go to around 3:30 
\begin{itemize}
	\item \href{https://www.youtube.com/watch?v=9LAtu39xpR8}{https://www.youtube.com/watch?v=9LAtu39xpR8}. 
\end{itemize}
%\begin{figure}[H]
% 	\centering
%	\includegraphics[width=.55\textwidth]{"Pictures/Electronics/Rpi solder pads".PNG}
% 	\caption{Raspberry Pi Solder pads}
%	\label{pi solder pads}
%\end{figure}

\begin{figure}[H]
 	\centering
  	\begin{minipage}[b]{0.40\textwidth}
		\includegraphics[width=\textwidth]{"Pictures/Electronics/Rpi solder pads".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.50\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Electronics/rpi solder diagram".png}
  	\end{minipage}
	\caption{Raspberry Pi 3 soldering pads}
	\label{rpi pads}
\end{figure}



\subsection{Serial Communication}

\textbf{Connecting the Raspberry Pi to Serial Splitter Board:} In order for the Raspberry Pi to talk to the motor controllers we will be using Serial communication. Figure \ref{ss} shows the section of the power diagram we'll be working on, with the power connections shown in \textcolor{red}{\textbf{RED}} and data lines in \textcolor{blue}{\textbf{BLUE}}. 

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.9\textwidth]{"Pictures/Electronics/serial split".PNG}
 	\caption{Serial Splitter Overview}
	\label{ss}
\end{figure}


%\begin{figure}[H]
% 	\centering
%  	\begin{minipage}[b]{0.48\textwidth}
%		\includegraphics[width=\textwidth]{"Pictures/Electronics/serial split".PNG}
%  	\end{minipage}
%  	\hfill
%  	\begin{minipage}[b]{0.48\textwidth}
%    		\includegraphics[width=\textwidth]{"Pictures/Electronics/serial data".png}
%  	\end{minipage}
%	\caption{Serial Overview}
%	\label{ss}
%\end{figure}

\begin{table}[H]
	\centering
	\arrayrulecolor{lightgray}
	\sffamily\footnotesize
	\captionsetup{font={sf,bf}}
	\caption{Parts Necessary}
	\begin{tabular}{|N|Q|Q|I|N|Q|Q|I|}
			\hline
			\thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} & \thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} \\
			\hline
			POPULATED Custom Serial Splitter PCB & N/A & 1 & \partimg{"Pictures/Board Testing/ss1".PNG} & Female/Female Jumper Wires & E18 & 24 & \partimg{../../../images/parts_list/E18.png} \\ \hline
	\end{tabular}
\end{table}

NOTE: Before completing this section, you will need to populate the custom PCB boards that you received. Make sure you have completed all the custom PCB population and testing in the PCB Testing.pdf document before continuing with this document.

Figure \ref{rpi to rc} shows the schematic and pin-out of how to connect the Pi, Serial Splitter board, and Motor Controllers. From the Raspberry Pi we use the UART TX and RX pins, which correspond to pins \#8 and \#10, or GPIO14 and GPIO15. In addition we will be passing 5V to the motor controllers for the logic battery controller which is used by the encoders and digital logic. For this use the 5V PWR rail which is pin  \#2 or \#4 and any of the GND pins (we recommend pin \#6). Raspberry Pi GPIO diagrams can be found on the following page in Figure \ref{RPi 3 pinout}.

\begin{figure}[H]
 	\centering
	\includegraphics[width=.85\textwidth]{"Pictures/Electronics/ReadWrite hookup schematic".PNG}
 	\caption{RPi connections to RoboClaws}
	\label{rpi to rc}
\end{figure}


Below shows the description of what each pin connects from and to on the Serial Splitter board. Use this in combination with Figure \ref{rpi to rc} and Figure \ref{Read/Write Board} to make the serial connections to the RoboClaw Motor Controllers. 

\bigskip

\begin{tabular}[2] {| p{2.5cm} | p{11cm} |}
	\hline
	\textbf{Pin} & \textbf{Description} \\ \hline
	\textcolor{red}{1} & \textcolor{red}{+5V from Raspberry Pi 5V DC pin \#2 or \#4} \\ \hline
	\textcolor{green}{2} & \textcolor{green}{Serial Write line, TX from Raspberry Pi GPIO 14} \\ \hline
	\textcolor{magenta}{3} & \textcolor{magenta}{Serial Read line, RX from Raspberry Pi GPIO 15}	\\ \hline
	4 & GND from Raspberry Pi GND pin \#6 \\ \hline
	\textcolor{red}{5,9,13,17,21} & \textcolor{red}{5V to RoboClaws LB + pin} \\ \hline
	\textcolor{green}{6,10,14,18,22} & \textcolor{green}{Serial Write to RoboClaws S1 pin} \\ \hline
	\textcolor{magenta}{7,11,15,19,23} & \textcolor{magenta}{Serial Read to RoboClaws S2 pin} \\ \hline
	8,12,16,20,24 & GND to RoboClaws LB - pin \\ \hline 
\end{tabular}

\bigskip 

\mybox{Please note that there is a difference between the pin numbers for the physical pins on the Raspberry Pi 3 and their  corresponding GPIO pin numbers (for instance, physical pin \#8 is GPIO 14). Consult Raspberry Pi forums and documentation if you need additional information.}


\begin{figure}[H]
 	\centering
  	\begin{minipage}[b]{0.35\textwidth}
		\includegraphics[width=\textwidth]{"Pictures/Electronics/rp3_pinout2".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.45\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Electronics/pi3_gpio".png}
  	\end{minipage}
	\caption{Raspberry Pi 3 pinout}
	\label{RPi 3 pinout}
\end{figure}

\begin{figure}[H]
 	\centering
	\includegraphics[width=.75\textwidth]{"Pictures/Electronics/ReadWriteBoard".PNG}
 	\caption{Read/Write Board}
	\label{Read/Write Board}
\end{figure}

\begin{figure}[H]
 	\centering
	\includegraphics[width=.75\textwidth]{"Pictures/Electronics/RoboClaw pinout".PNG}
 	\caption{RoboClaw pinout}
	\label{RC pinout}
\end{figure}

Next, follow Figure \ref{rpi to rc} and the pinout Figures \ref{Read/Write Board} and \ref{RC pinout} to connect the signals to each individual RoboClaw\footnote{The pin number in Figure \ref{rpi to rc} for the Serial Splitter Board corresponds to the pin numbers in Figure \ref{Read/Write Board}}. For more information on the pins for the RoboClaws and their purpose refer to the RoboClaw Manual and data sheet. 

\noindent Examples of the wiring and routing can be seen in Figure \ref{ss2rc1} and Figure \ref{ss2rc2}

\begin{figure}[H]
 	\centering
	\includegraphics[width=.75\textwidth]{"Pictures/Routing/ss2rc".PNG}
 	\caption{Serial Splitter to RoboClaws (shows 1 of 5 RoboClaws finished)}
	\label{ss2rc1}
\end{figure}

\begin{figure}[H]
 	\centering
  	\begin{minipage}[b]{0.50\textwidth}
		\includegraphics[width=\textwidth]{"Pictures/Routing/ss2rc2".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.40\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Routing/ss2rc3".png}
  	\end{minipage}
	\caption{Serial signal routing}
	\label{ss2rc2}
\end{figure}

\section{Connecting Motors/Encoders}

Next we can connect the motors and encoders to the RoboClaw motor controllers. For each of the 10 motors you will need to connect motor power as well as the encoders. This means that there will be close to 60 wires traveling between the motor controllers and the motors/encoders, so it is very important to try to keep your wires organized and bundled together well. Below is some information about strain relief and using wire braid in your electronics systems.  See these links and Figures \ref{wiring1} and \ref{wiring2} for examples.

\begin{itemize}
	\item \href{https://www.techopedia.com/definition/2301/strain-relief}{https://www.techopedia.com/definition/2301/strain-relief}
	\item \href{https://www.youtube.com/watch?v=FeCs98TSsYQ}{https://www.youtube.com/watch?v=FeCs98TSsYQ}
\end{itemize}


%\begin{figure}[H]
% 	\centering
%	\includegraphics[width=.75\textwidth]{"Pictures/Electronics/wiring".PNG}
% 	\caption{Wire routing examples}
%	\label{wiring}
%\end{figure}

\begin{figure}[H]
  	\centering
  	\begin{minipage}[b]{0.34\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Routing/route1".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.29\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Routing/route2".PNG}
  	\end{minipage}
    	\hfill
  	\begin{minipage}[b]{0.30\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Routing/route3".PNG}
  	\end{minipage}
  	\caption{}
	\label{wiring1}
\end{figure}


\mybox{
An example of how we routed our wiring is shown by Figure \ref{wiring1}. It is important to give strain relief in the cable as you are routing it through, as well as to give extra wiring for the locations that can move. In addition, Figure \ref{wiring2} shows how we routed the wires through the rocker-bogie, and then from the rocker-bogie into the main body. Try to pick locations that reduce strain on the wires as the robot legs move when you are routing wires into the body.
}

\begin{figure}[H]
 	\centering
  	\begin{minipage}[b]{0.48\textwidth}
		\includegraphics[width=\textwidth]{"Pictures/Routing/route4".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.42\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Routing/route5".png}
  	\end{minipage}
	\caption{Serial signal routing}
	\label{wiring2}
\end{figure}

\begin{table}[H]
	\centering
	\arrayrulecolor{lightgray}
	\sffamily\footnotesize
	\captionsetup{font={sf,bf}}
	\caption{Parts Necessary}
	\begin{tabular}{|N|Q|Q|I|N|Q|Q|I|}
			\hline
			\thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} & \thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} \\
			\hline
			20AWG Wire (Black) & E30 & N/A & \partimg{../../../images/parts_list/wire.jpg} & 20AWG Wire (Red) & E31 & N/A & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
			30AWG Wire (White) & E34 & N/A & \partimg{../../../images/parts_list/wire.jpg} & 30AWG Wire (Blue) & E35 & N/A & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
			30AWG Wire (Yellow) & E36 & N/A & \partimg{../../../images/parts_list/wire.jpg} & 30AWG Wire (Green) & E37 & N/A & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
	\end{tabular}
\end{table}

\begin{tabular}[3] {| p{2cm} | p{7cm} | p{4cm} |}
	\hline
	\textbf{Section} & \textbf{Wires Needed} & \textbf{Length [inches]}  \\ \hline
	\textcolor{blue}{A} & \textcolor{blue}{2x 20AWG \& 4x 30AWG} & \textcolor{blue}{35} \\ \hline
	\textcolor{cyan}{B} & \textcolor{cyan}{2x 20AWG \& 4x 30AWG} & \textcolor{cyan}{28} \\ \hline
	\textcolor{green}{C} & \textcolor{green}{2x 20AWG \& 4x 30AWG} & \textcolor{green}{48} \\ \hline
	\textcolor{red}{D} & \textcolor{red}{2x 20AWG \& 3x 30AWG} & \textcolor{red}{20} \\ \hline
	\textcolor{magenta}{E} & \textcolor{magenta}{2x 20AWG \& 3x 30AWG} & \textcolor{magenta}{32} \\ \hline
\end{tabular}

\begin{figure}[H]
 	\centering
	\includegraphics[width=.75\textwidth]{"Pictures/Electronics/wire labels".PNG}
 	\caption{Wire lengths}
	\label{wire lengths}
\end{figure}

\subsection{Drive Motors}
We will begin with the drive motors (the 6 motors that are directly connected to each drive wheel). Figure \ref{motors over} shows the section of the power diagram we'll be working on, with lines with both encoder signals and motor power in \textcolor{violet}{\textbf{PURPLE}}.

\begin{figure}[H]
  	\centering
    	\includegraphics[width=.9\textwidth]{"Pictures/Electronics/motor overview".PNG}
 	\caption{Motor and Encoder Overview}
	\label{motors over}
\end{figure}


\noindent Make sure to look at which RoboClaw corresponds to which motors it is controlling. It is important that this ordering is preserved. Assign and mark each of your RoboClaws a number 1-5 and then follow Figure \ref{motorID} when connecting each to its motors. 

\begin{figure}[H]
 	\centering
	\includegraphics[width=.75\textwidth]{"Pictures/Electronics/Motor ID".PNG}
 	\caption{RoboClaw - Motor Assignments}
	\label{motorID}
\end{figure}

Figure \ref{Motor pinout} shows what each wire from the motor represents and Figure \ref{RC to Drive} shows which of those wires should connect to which pin on the RoboClaw motor controllers. Note that the white wire is represented by pink in Figure \ref{RC to Drive}.\footnote{Figure \ref{RC to Drive} shows only a single motor controller and 2 motors, broken into 2 pictures to reduce clutter on the image and increase wire readability. You will need to replicate Figure \ref{RC to Drive} for all 5 RoboClaws and all 10 motors.} 

\begin{figure}[H]
 	\centering
	\includegraphics[width=.65\textwidth]{"Pictures/Electronics/Motor pinout".PNG}
 	\caption{Motor pinout}
	\label{Motor pinout}
\end{figure}


\begin{figure}[H]
 	\centering
  	\begin{minipage}[b]{0.475\textwidth}
		\includegraphics[width=\textwidth]{"Pictures/Electronics/RoboClaw to Drive".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.425\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Electronics/RoboClaw to Drive2".png}
  	\end{minipage}
	\caption{Connecting RoboClaws to Drive Motors}
	\label{RC to Drive}
\end{figure}

\subsection{Corner Motors/Encoders}
The big difference between the corner motors and drive motors is the use of absolute encoders. The absolute encoders are separate from the motor and so we have to do a little bit of work to get them to interface with the motor controllers. Figure \ref{corner motors over} shows the section of the power diagram we'll be working on, with lines that power the motors in \textcolor{red}{\textbf{RED}} and encoder signals in \textcolor{blue}{\textbf{BLUE}}.


\begin{figure}[H]
  	\centering
    	\includegraphics[width=.9\textwidth]{"Pictures/Electronics/corner motor".PNG}
 	\caption{Corner Motor and Encoder Overview}
	\label{corner motors over}
\end{figure}

\begin{table}[H]
	\centering
	\arrayrulecolor{lightgray}
	\sffamily\footnotesize
	\captionsetup{font={sf,bf}}
	\caption{Parts Necessary}
	\begin{tabular}{|N|Q|Q|I|N|Q|Q|I|}
			\hline
			\thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} & \thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} \\
			\hline
			POPULATED Voltage Divider PCB & N/A & 1 & \partimg{"../PCB Testing/Pictures/Board Testing/vd1".PNG} & Jumper Wires & E18 & 14 & \partimg{../../../images/parts_list/E18.png} \\ \hline
			3-Pin Micro Connectors & E10 & 4 & \partimg{../../../images/parts_list/E10.png} & & & & \\ \hline
	\end{tabular}
\end{table}

 The corner motors only have the two connections to the physical motor, the (+) and (-) going to the top of the motor. However, you must also hook up the absolute encoder. When plugged into the encoder, the 3-pin Micro connector will have 3 wires coming out of it, shown in Figure \ref{3pin}.


\bigskip 

\begin{figure}[H]
 	\centering
	\includegraphics[width=.65\textwidth]{"Pictures/Electronics/3 pin pic".PNG}
 	\caption{3-pin Micro connector}
	\label{3pin}
\end{figure}

\bigskip
\begin{tabular}[3] {| p{3cm} | p{7cm} | p{3cm} | }
	\hline
	\textbf{Pin} & \textbf{Description} & \textbf{Color} \\ \hline
	1 & +5V DC Power & \textcolor{orange}{\textbf{Orange}} \\ \hline
	2 & 0-5V Analog & \textcolor{blue}{\textbf{Blue}} \\ \hline
	3 & Ground & \textcolor{brown}{\textbf{Brown}} \\ \hline
\end{tabular}


The absolute encoder will be hooked up similarly to the encoders for the drive motor on the RoboClaw side, with the exception of the OUTPUT B signal which doesn't exist for absolute encoder types: it just needs to send the 10-bit analog signal to the RoboClaw. However, there is an issue where the encoder outputs signals on a 0-5V scale, but the RoboClaw expects an input of 0-2V for an absolute encoder value. To address this issue, we will use the Encoder Voltage Divider PCB, the pinout of which can be seen in Figure \ref{vd pinout}. Connect the corner motors, the Encoder Voltage Divider PCB, and the RoboClaws according to Figure \ref{RC to Steering}.

\begin{figure}[H]
 	\centering
	\includegraphics[width=.65\textwidth]{"Pictures/Electronics/Encoder Board".PNG}
 	\caption{Encoder Voltage Divider board pinout}
	\label{vd pinout}
\end{figure}

\begin{tabular}[2] {| l | c |}
	\hline
	\textbf{Pin} & \textbf{Description} \\ \hline
	1,4,7,10 & +5V Input to Encoders \\ \hline
	2,5,8,11 & 0-5V Signal from Encoders based on position \\ \hline
	3,6,9,12 & GND for Encoders \\ \hline \hline
	13,16,19,22 & +5V Power from each respective RoboClaw \\ \hline
	14,17,20,23 & 0-2V Signal Output to RoboClaws, after voltage division on board \\ \hline
	15,18,21,24 & GND from each respective RoboClaw \\ \hline \hline
	25 & +5V from Raspberry Pi power rail \\ \hline
	26 & GND from Raspberry Pi pin \\ \hline
\end{tabular}

\begin{figure}[H]
 	\centering
	\includegraphics[width=1\textwidth]{"Pictures/Electronics/RoboClaw to Steering".PNG}
 	\caption{Connecting RoboClaws to Corner Motors}
	\label{RC to Steering}
\end{figure}

Once all 10 of the motors are connected and in the system, we are ready to move onto the motor tuning and calibration process which is documented in the Calibration.pdf document. Make sure to double check all your wire connections and that they are into the correct pins before moving on. We recommend calibrating your motors and having the robot functioning before moving on to the LED Matrix due to simplicity and ease of debugging, though either order would be fine.

\section{Connecting the LED Matrix}
The code in the osr-rover-code repository contains all the code you need to get the LED matrix up and running.  Simply clone that repository as described in the Software Steps document and hook up the wires as described below.  For additional background on the LED matrix portion of the project: We followed along with a project on Adafruit to hook up the Raspberry Pi to the LED matrix, with the addition of the logic shifter board between the Pi and LED matrix. That project can be found at:

\begin{itemize}
	\item \href{https://learn.adafruit.com/connecting-a-16x32-rgb-led-matrix-panel-to-a-raspberry-pi/overview}{https://learn.adafruit.com/connecting-a-16x32-rgb-led-matrix-panel-to-a-raspberry-pi/overview}
\end{itemize}

\begin{table}[H]
	\centering
	\arrayrulecolor{lightgray}
	\sffamily\footnotesize
	\captionsetup{font={sf,bf}}
	\caption{Parts Necessary}
	\begin{tabular}{|N|Q|Q|I|N|Q|Q|I|}
			\hline
			\thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} & \thead{Item} & \thead{Ref} & \thead{Qty} & \thead{Image} \\
			\hline
			POPULATED Logic Shifter PCB & N/A & 1 & \partimg{"../PCB Testing/Pictures/Board Testing/ls2".PNG} & Jumper Wires & E18 & 30 & \partimg{../../../images/parts_list/E18.png} \\ \hline
			20AWG Wire (Black) & E30 & N/A & \partimg{../../../images/parts_list/wire.jpg} & 20AWG Wire (Red) & E31 & N/A & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
			30AWG Wire (White) & E34 & N/A & \partimg{../../../images/parts_list/wire.jpg} & 30AWG Wire (Blue) & E35 & N/A & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
			30AWG Wire (Yellow) & E36 & N/A & \partimg{../../../images/parts_list/wire.jpg} & 30AWG Wire (Green) & E37 & N/A & \partimg{../../../images/parts_list/wire.jpg} \\ \hline
	\end{tabular}
\end{table}

\noindent Figure \ref{rpi2led} shows an overview of how the logic shifters are used between the signals from the Raspberry Pi and the LED Matrix. This diagram does not include the actual pin connectors to the Logic Shifter board; it is just to demonstrate the signal path.

\begin{figure}[H]
 	\centering
	\includegraphics[width=0.7\textwidth]{"Pictures/Electronics/RPi to LED".PNG}
 	\caption{Raspberry Pi connections to LED Matrix}
	\label{rpi2led}
\end{figure}


\noindent The Logic Shifter PCB is not included in the Adafruit project. The following steps describe how to include the Logic Shifter PCB in the wiring and routing. Figure \ref{ls2pi} shows the pin connections on the logic shifter, labeled with which pin they connect to on the Raspberry Pi. We suggest putting the logic shifter board in the 3D printed head, and routing the wires through the body and up through the PVC pipe "neck". 

\noindent Make sure to use the thicker gauge wire (20AWG) for powering the LED matrix as it can pull up to 5 amps of current. All the other signals to the LED matrix are digital signals for which the 30 AWG wire is sufficient. 

\begin{figure}[H]
 	\centering
  	\begin{minipage}[b]{0.45\textwidth}
		\includegraphics[width=\textwidth]{"Pictures/Electronics/ls to pi".PNG}
  	\end{minipage}
  	\hfill
  	\begin{minipage}[b]{0.45\textwidth}
    		\includegraphics[width=\textwidth]{"Pictures/Electronics/pi3_gpio".png}
  	\end{minipage}
	\caption{Raspberry pi to Logic Shifter board}
	\label{ls2pi}
\end{figure}

\textbf{**Note**} In Figure \ref{ls2pi}, the pin labels on the board (left) correspond to the pin NAME and not the physical pin number. For example, GPIO 12 is GPIO 12 and \textbf{NOT} physical pin \#12.

\begin{figure}[H]
 	\centering
	\includegraphics[width=0.5\textwidth]{"Pictures/Electronics/ls to led".PNG}
 	\caption{Logic Shifter to LED Matrix}
	\label{ls2led}
\end{figure}

Figure \ref{ls2led} shows the connections out of the Logic Shifter board to the LED Matrix. Make sure to use the INPUT side of the LED matrix. The pins' names/labels can be found directly on the LED Matrix.  



\end{document}